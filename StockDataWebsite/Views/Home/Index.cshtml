@{
    ViewData["Title"] = "Home Page";
}
@model StockDataWebsite.Models.CompanySelection

<h2>Select a Company for Financial Data</h2>

<form asp-action="SearchResults" method="get"> <!-- Ensure this is correct -->
    <div class="form-group">
        <label for="CompanySearch">Search by Company Name or Symbol</label>
        <input type="text" class="form-control" id="CompanySearch" name="CompanySearch" placeholder="Enter company name or symbol" required />
        <div id="suggestions" class="list-group"></div>
    </div>

    <button type="submit" class="btn btn-primary custom-margin">Search</button>
</form>
<!-- JavaScript for dynamic dropdown suggestions -->
<script>
   document.getElementById('CompanySearch').addEventListener('input', function () {
    const query = this.value;

    if (query.length >= 2) {
        fetch(`/api/companies/search?query=${query}`)
            .then(response => response.json())
            .then(data => {
                const suggestions = document.getElementById('suggestions');
                suggestions.innerHTML = ''; 

                if (data.length > 0) {
                    data.forEach(company => {
                        const suggestionItem = document.createElement('a');
                        suggestionItem.classList.add('list-group-item', 'list-group-item-action');
                        suggestionItem.textContent = `${company.companyName} (${company.companySymbol})`;

                        suggestionItem.addEventListener('click', function () {
                            document.getElementById('CompanySearch').value = company.companyName;
                            suggestions.innerHTML = ''; // Clear suggestions
                        });

                        suggestions.appendChild(suggestionItem);
                    });
                } else {
                    suggestions.innerHTML = '<div class="list-group-item">No results found</div>';
                }
            })
            .catch(error => console.error('Error fetching suggestions:', error));
    }
});

</script>
